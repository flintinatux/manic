<!DOCTYPE html>
<html>
  <head>
    <title>Manic Demo</title>
    <script type="text/javascript" src="dist/manic.js"></script>
    <style type="text/css">
      #game { border: 1px solid black; }
      .Fast, .Slow { background: black; }
      .PlayerOne { background: blue; }
      .PlayerTwo { background: red; }
    </style>
  </head>
  <body>
    <div id="game"></div>
    <script type="text/javascript">
      var manic = Manic(document.getElementById('game'), 0.6);

      manic.component('Controls', function(entity, { up, down }) {
        return function update(ctx) {
          var { keys } = ctx.inputs;
          if (keys.has(up))   return entity('ay', -entity('amax'));
          if (keys.has(down)) return entity('ay',  entity('amax'));
          entity('ay', 0);
        }
      });

      manic.component('LifeSpan', function(entity, opts) {
        setTimeout(entity.kill, opts.ms);
        return function(){};
      });

      manic.component('Oscillating', function(entity, { amp, dir, rate }) {
        var step = 0;
        return function update(ctx) {
          entity(`v${dir}`, amp * Math.cos(rate * step++));
        }
      });

      manic.types({
        Ball: {
          components: {
            Motion: {},
            Render:  {}
          }
        },
        Fast: {
          parent: 'Ball',
          components: {
            LifeSpan: {
              ms: 5000
            },
            Oscillating: {
              amp:  1,
              dir:  'y',
              rate: 0.1
            }
          }
        },
        Player: {
          components: {
            Motion: {},
            Render:  {}
          },
          defaults: {
            amax: 0.075,
            vmax: 0.8
          }
        },
        PlayerOne: {
          parent: 'Player',
          components: {
            Controls: {
              down: 's',
              up:   'w'
            }
          }
        },
        PlayerTwo: {
          parent: 'Player',
          components: {
            Controls: {
              down: 'down',
              up:   'up'
            }
          }
        },
        Slow: {
          parent: 'Ball',
          components: {
            Oscillating: {
              amp:  2,
              dir:  'x',
              rate: 0.05
            }
          }
        }
      });

      manic.stage([
        {
          type: 'Slow',
          state: {
            h: 2,
            w: 2,
            x: 50,
            y: 30
          }
        },
        {
          type: 'Fast',
          state: {
            h: 2,
            w: 2,
            x: 50,
            y: 30
          }
        },
        {
          type: 'PlayerOne',
          state: {
            h: 16,
            w: 2,
            x: 4,
            y: 30
          }
        },
        {
          type: 'PlayerTwo',
          state: {
            h: 16,
            w: 2,
            x: 96,
            y: 30
          }
        }
      ]);
    </script>
  </body>
</html>
